# 🏠 Mini Project 2 – IoT 스마트홈 시스템

## 📌 프로젝트 개요
STM32 보드와 Raspberry Pi 서버를 중심으로, **WiFi·Bluetooth·MariaDB**를 연동한 스마트홈 시스템을 구현했습니다.  
화재/가스/진동 센서와 PIR 모션 감지, 기상청 정보기반 환기 기능, 온습도 기반 냉난방 제어, RFID 출입 관리, NTP 서버시간 기반 예약 기능 **지능형 안전·편의 기능**을 제공하는 AIoT 기반 주거 환경 솔루션입니다.  

---

## 🔧 개발 기간
- **2025.08.22 ~ 2025.08.26 (5일)**

---

## 🛠 개발 환경 및 도구

### 🔹 Hardware
- **STM32 Nucleo-F411RE** (센서 데이터 처리, 제어 로직, FreeRTOS 태스크 실행)  
- **Raspberry Pi 5** (서버 + MariaDB, 중앙 제어)  
- **ESP8266 WiFi 모듈** (서버와 데이터 송수신)  
- **센서류** : 온습도(DHT11), 가스/화재, 진동, PIR 센서  
- **액추에이터** : Servo Motor (창문 개폐), LED, Buzzer, Fan  
- **RFID 리더기** (출입 인증 및 로그 기록)  

### 🔹 Software
- STM32CubeIDE (펌웨어 개발)  
- FreeRTOS (멀티태스킹 기반 태스크 관리)  
- HAL Driver (STM32 주변장치 제어)  
- MariaDB (센서 데이터 저장 및 로그 관리)  
- Python (라즈베리파이 서버 및 API 연동)  
- Mobile/Web App (실시간 모니터링 & 제어)  

---

## ⚙️ 주요 기능
- **재난 감지 및 안전**
  - 가스·화재·진동 센서 → 위험 감지 시 즉각 경보 & 서버 알림  
  - PIR 센서 → 침입 감지 및 푸시 알림   

- **환경 제어**
  - 온습도 센서 → 냉난방 자동 제어  
  - 기상청 API 기반 날씨 데이터 수집 → 환기(창문 개폐) 및 냉난방 최적화  
  - LED 색상으로 외부 날씨·온도 직관적 표시 (녹색/노란색/빨간색)  

- **출입 관리**
  - RFID 태그 인증 → 출입 기록 DB 저장  
  - PIR → 방문자 감지

- **자동화 기능**
  - 예약 시스템 → 조명·에어컨·난방·창문 개폐 자동화  
  - 알림 시스템 → 예약 실행 전/후 상태 알림, 충돌 경고, 오작동 감지  

---

## 💡 사용 기술
C / STM32 / FreeRTOS / UART / I2C / GPIO / WiFi / Bluetooth / MariaDB / Sensor / NTP / Weather API / RFID  

---

## 🧩 FreeRTOS 기반 Task 구조
- **AiotTask** : IoT 시스템 메인 로직 (Normal, 256×4)  
- **NTPTask** : 시간 동기화 (BelowNormal, 512×4)  
- **WeatherTask** : 기상청 API 처리, 날씨 기반 제어 (BelowNormal, 1024×4)  
- **CommandTask** : 명령 처리 및 프로토콜 핸들링 (High, 256×4)  
- **LCDTask** : LCD 출력 전용 태스크 (BelowNormal, 256×4)  
- **RFIDTask** : 출입 인증, 로그 저장 (Normal, 256×4)  
- **THTask** : 온습도 센서 주기적 수집 (Low, 256×4)  
- **PIRTask** : 모션 감지 및 알림 (Low, 256×4)  
- **ScheduleTask** : 예약·자동화 기능 수행 (Low, 128×4)

- **BTTask** : 블루투스(UART6) 통신 처리 (로그 전송, 외부 명령)  
- **SensorTask** : 화재·진동·가스 센서 감지 및 이벤트 처리  
- **LCDTask** : Queue & Mutex 기반 LCD1602 출력 (시간·알람·상태 표시)  
- **PIRTask** : 인체 감지(PIR 센서) 이벤트 처리, Buzzer 알람/LED 제어와 연동  

**동기화 리소스 (Mutex)**  
- `ESP_Mutex` : WiFi/ESP 통신 보호  
- `NTP_Mutex` : 시간 동기화 충돌 방지  
- `Weather_Mutex` : 기상 데이터 공유 보호  

---

## 🐞 Trouble Shooting
- **WiFi 연결 불안정** → 재시도 로직 추가, 응답 없을 시 자동 리셋  
- **FreeRTOS 태스크 충돌** → Mutex & Queue 적용으로 통신/DB 접근 동기화  
- **센서 신호 노이즈** → 소프트웨어 디바운싱 및 필터링 적용  
- **ESP32-CAM 연동 실패** → 시간 부족으로 1차 시도만 진행, 향후 개선 예정  

---

## 📈 개발 성과
- **WiFi·Bluetooth + MariaDB 연동**으로 실시간 데이터 수집·저장·모니터링 구현  
- **재난 대응 기능** : 가스·화재·진동·침입 상황 조기 감지 및 알림  
- **환경 제어 기능** : 자동 환기·냉난방·에너지 효율 최적화 구현  
- **보안 강화** : PIR·RFID 연동으로 외부 침입 감지 & 출입 로그 관리
- **FreeRTOS 멀티태스킹 설계** → 안정적 동작 보장  

---

## 🚀 기대 효과 및 향후 계획
- **보안 강화** : 외부인 침입 차단, 택배 도난 방지, 출입 로그 관리  
- **안전 확보** : 화재·가스·진동 조기 경보 및 대응 체계 확립  
- **생활 편의성** : 자동 환기·온습도 제어·예약 시스템 통한 스마트 환경 제공  
- **발전 방향** :  
  - AI 영상 분석 (얼굴 인식, 이상 행동 탐지)  
  - 클라우드 연동 로그 백업  
  - 음성 제어 및 스마트 스피커 연계  

---

## 📸 시스템 블록 다이어그램
```plaintext
   +-------------------+         +------------------+
   |   NTP / Weather   |  WiFi   |   Raspberry Pi   |
   |       Server      | <-----> |   (MariaDB)      |
   +-------------------+         +------------------+
                                           ^
                                           |
                                  WiFi / Bluetooth 통신
                                           |
            +------------------------------+------------------------------+
            |                           STM32                             |
            |                      (FreeRTOS 기반)                        |
            +-------+-----------+-----------+-----------+-----------------+
                    |           |           |           | 
                  DHT11       PIR       Gas/Flame    Vibration
                 (온습도)   (인체감지)  (가스/화재)    (진동센서)
                    |
            자동제어 (Fan, LED)
